cd $SD_ARTIFACTS_DIR && find . -type f -print > manifest.txt && find . -type f -exec sh -c 'f=`echo $1 | sed "s/^\.\///"`; ALLOW_VERSION=072901; CURL_VERSION=$(curl -V | head -1 | awk "{print \$2}" | awk -F. "{printf \"%02d%02d%02d\", \$1, \$2, \$3}"); curlWrapper=$(if test ${CURL_VERSION:-0} -ge $ALLOW_VERSION; then echo "eval"; else echo "sd-step exec core/curl"; fi); encoded=$(${curlWrapper} "curl -s -w \"%{url_effective}\" --data-urlencode $f -G \"\" | sed -e \"s/^\/?//\""); curl -H "Authorization: Bearer $SD_TOKEN" -H "Content-Type: text/plain" -X PUT https://store.screwdriver.cd/v1/builds/$SD_BUILD_ID/ARTIFACTS/$encoded -T ./$f' -- {} \;
